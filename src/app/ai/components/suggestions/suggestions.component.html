<div class="suggestions" *ngIf="suggestions$ | async as raw">
  <header class="s-header">
    <div class="left">
      <h2>Suggestions <span class="badge" *ngIf="raw.length">{{ raw.length }}</span></h2>
      <div class="search-box">
        <input type="text" placeholder="Filter..." [value]="filter()" (input)="setFilter($any($event.target).value)" aria-label="Filter suggestions" />
      </div>
    </div>
    <div class="right">
      <button type="button" (click)="regen()" class="regen">Regenerate</button>
    </div>
  </header>
  <section class="weights" *ngIf="ai$ | async as ai">
    <div class="slider"><label>Urgency<div class="value">{{ ai.profile.weightUrgency | number:'1.1-1' }}</div><input type="range" min="0" max="3" step="0.1" [value]="ai.profile.weightUrgency" (input)="set('weightUrgency',$any($event.target).value)"/></label></div>
    <div class="slider"><label>Priority<div class="value">{{ ai.profile.weightPriority | number:'1.1-1' }}</div><input type="range" min="0" max="3" step="0.1" [value]="ai.profile.weightPriority" (input)="set('weightPriority',$any($event.target).value)"/></label></div>
    <div class="slider"><label>Age<div class="value">{{ ai.profile.weightAge | number:'1.1-1' }}</div><input type="range" min="0" max="3" step="0.1" [value]="ai.profile.weightAge" (input)="set('weightAge',$any($event.target).value)"/></label></div>
  </section>
  <ul class="list" *ngIf="filtered(raw) as list">
    <li *ngFor="let s of list; trackBy: trackId" [class.in-focus]="(focusIds$ | async)?.includes(s.cardId)">
      <div class="card-row">
        <div class="score" [attr.data-score]="s.score" [style.background]="scoreBg(s.score)">{{ s.score | number:'1.0-0' }}</div>
        <div class="main-col">
          <div class="title" (click)="openCard(s.cardId)" role="button" tabindex="0" title="Open card">
            {{ s.cardTitle }}
            <span class="priority" *ngIf="s.priority" [class.p-high]="s.priority==='high'" [class.p-medium]="s.priority==='medium'" [class.p-low]="s.priority==='low'">{{ s.priority }}</span>
          </div>
          <div class="meta">
            <span class="date" *ngIf="s.proposedDate">ðŸ“… {{ s.proposedDate }}</span>
            <span class="badge u" title="Urgency weight">U</span>
            <span class="badge p" title="Priority weight">P</span>
            <span class="badge a" title="Age weight">A</span>
          </div>
        </div>
        <div class="actions" *ngIf="!(focusIds$ | async)?.includes(s.cardId)">
          <button (click)="apply(s.id)" class="primary" title="Apply proposed date">Apply</button>
          <button (click)="dispatchAdd(s.cardId)" title="Add to Daily Focus">+Focus</button>
        </div>
        <div class="feedback">
          <button (click)="accept(s.id)" title="Accept ranking" class="good">âœ”</button>
          <button (click)="reject(s.id)" title="Reject ranking" class="bad">âœ•</button>
        </div>
      </div>
    </li>
    <li class="empty" *ngIf="!list.length">
      <div class="placeholder">No suggestions. Try Regenerate.</div>
    </li>
  </ul>
</div>
