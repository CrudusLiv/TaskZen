<div class="k-column card" [class.is-collapsed]="collapsed" role="listitem" [attr.aria-label]="'Column '+ column.title" [attr.aria-expanded]="!collapsed">
  <div class="k-col-header" role="heading" aria-level="2">
    <button type="button" class="collapse-btn" (click)="toggleCollapse()" [attr.aria-label]="(collapsed? 'Expand' : 'Collapse') + ' column '+column.title" [attr.aria-pressed]="collapsed">
      <span class="chevron" aria-hidden="true"></span>
    </button>
    @if (!editing) {
      <h3 (dblclick)="beginEdit()" (keydown.enter)="beginEdit()" tabindex="0">{{ column.title }} <span class="count" aria-label="Cards in column">{{ cards.length }}</span></h3>
    } @else {
      <input [(ngModel)]="titleDraft" (keyup.enter)="commitTitle()" (blur)="commitTitle()" />
    }
    <div class="k-col-actions" role="group" aria-label="Column actions">
      <button type="button" class="icon-btn" (click)="addCard()" title="Add card">ï¼‹</button>
      <button type="button" class="icon-btn" (click)="sort.emit('due')" [class.active]="column.sort==='due'" title="Sort by due">ðŸ•’</button>
      <button type="button" class="icon-btn" (click)="sort.emit('priority')" [class.active]="column.sort==='priority'" title="Sort by priority">âš‘</button>
      <button type="button" class="icon-btn" (click)="sort.emit('created')" [class.active]="column.sort==='created'" title="Sort by created">â“˜</button>
      <button type="button" class="icon-btn danger" (click)="deleteColumn()" title="Delete column">âœ•</button>
    </div>
  </div>
  <div *ngIf="!collapsed" cdkDropList [id]="column.id" [cdkDropListData]="cards" [cdkDropListConnectedTo]="connectedTo" (cdkDropListDropped)="drop($event)" class="k-card-list" role="list" [attr.aria-label]="'Cards in '+ column.title">
    @if (cards.length) {
      <div *ngFor="let card of cards" cdkDrag class="k-card-wrapper">
        <app-kanban-card [card]="card" [highlight]="highlight"
          (open)="open.emit($event)"
          (delete)="removeCard.emit($event)"
          (update)="updateCard.emit({ id: card.id, changes: $event })"
          (toggle)="toggleCard.emit(card.id)"></app-kanban-card>
      </div>
    } @else {
      <div class="k-empty">No cards</div>
    }
  </div>
</div>
